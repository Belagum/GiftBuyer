# GiftBuyer

–í–µ–±-–ø–∞–Ω–µ–ª—å –∏ –±–æ—Ç –¥–ª—è **–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏ Telegram-–ø–æ–¥–∞—Ä–∫–æ–≤** –Ω–∞ –±–∞–∑–µ **Flask + SQLAlchemy + Pyrogram** (backend) –∏ **React + Vite** (frontend).
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ –∑–≤—ë–∑–¥, —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º **.tgs (Lottie)**, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–∞–Ω–∞–ª–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (–ø–æ —Ü–µ–Ω–µ –∏ supply), –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –∫–∞–Ω–∞–ª—ã/–õ–° –∏ **–∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞ –ª–∏–º–∏—Ç–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–∞ –Ω—É–∂–Ω—ã–µ –∫–∞–Ω–∞–ª—ã**.

---

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω (httpOnly cookie, 7 –¥–Ω–µ–π).
* üë§ –ù–µ—Å–∫–æ–ª—å–∫–æ **API-–ø—Ä–æ—Ñ–∏–ª–µ–π** (api\_id/api\_hash) –∏ **–Ω–µ—Å–∫–æ–ª—å–∫–æ Telegram-–∞–∫–∫–∞—É–Ω—Ç–æ–≤** –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
* ‚≠ê –ü—Ä–æ—Å–º–æ—Ç—Ä Premium, **–±–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥**, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Å–æ —Å—Ç—Ä–∏–º–æ–º —Å—Ç–∞–¥–∏–π (NDJSON).
* üéÅ **–ü–æ–¥–∞—Ä–∫–∏ (Gifts)**: —Å–ø–∏—Å–æ–∫, —Ä—É—á–Ω–æ–µ/—Ñ–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, SSE-—Å—Ç—Ä–∏–º, –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä .tgs (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—ç—à).
* üì° **–ö–∞–Ω–∞–ª—ã**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ `channel_id` (—Ñ–æ—Ä–º–∞—Ç `-100‚Ä¶`), –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–ª–µ–Ω—Å—Ç–≤–∞, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ **—Ü–µ–Ω–∞/supply**, CRUD.
* ü§ñ **–ê–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞** –ª–∏–º–∏—Ç–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª—ã –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º, —Å –æ—Ç—á—ë—Ç–∞–º–∏ –≤ –õ–° –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –ø—Ä–∏—á–∏–Ω–∞–º–∏, –µ—Å–ª–∏ –Ω–µ –∫—É–ø–∏–ª–æ—Å—å.
* üîî **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –Ω–æ–≤—ã—Ö –ø–æ–¥–∞—Ä–∫–∞—Ö –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã/–õ–° (—Å–æ —Å—Ç–∏–∫–µ—Ä–æ–º –∏ –∫—Ä–∞—Ç–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º).
* üßµ –ë—ç–∫–≥—Ä–∞—É–Ω–¥-–≤–æ—Ä–∫–µ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤, —É—Å—Ç–æ–π—á–∏–≤—ã–π –∫ –ø–∞–¥–µ–Ω–∏—è–º –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º, —Å ¬´–≥–æ—Ä—è—á–∏–º¬ª –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–Ω–∏–µ–º –∞–∫–∫–∞—É–Ω—Ç–æ–≤.
---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞ (–∫—Ä–∞—Ç–∫–æ –ø—Ä–æ –∞–ª–≥–æ—Ä–∏—Ç–º)

–§–∞–π–ª: `backend/services/autobuy_service.py`

1. **–°–±–æ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

   * –ë–µ—Ä—ë–º **–≤—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–∑–Ω–∞—ë–º –∏—Ö **–±–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥**.
   * –ë–µ—Ä—ë–º **–≤—Å–µ –∫–∞–Ω–∞–ª—ã** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏—Ö —Ñ–∏–ª—å—Ç—Ä—ã:

     * –¥–∏–∞–ø–∞–∑–æ–Ω `price_min..price_max`;
     * –¥–∏–∞–ø–∞–∑–æ–Ω `supply_min..supply_max` (–µ—Å–ª–∏ `null` ‚Äî —Ç—Ä–∞–∫—Ç—É–µ—Ç—Å—è –∫–∞–∫ ¬´–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è¬ª).
   * –ë–µ—Ä—ë–º **–Ω–æ–≤—ã–µ –ø–æ–¥–∞—Ä–∫–∏**, –ø—Ä–∏—à–µ–¥—à–∏–µ –æ—Ç –≤–æ—Ä–∫–µ—Ä–∞.
     ‚ö†Ô∏è –í –±–æ–µ–≤–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–∫—É–ø–∞–µ–º **—Ç–æ–ª—å–∫–æ –ª–∏–º–∏—Ç–Ω—ã–µ** (`is_limited=True`). –ù–µ–ª–∏–º–∏—Ç–Ω—ã–µ —Å—Ä–∞–∑—É ¬´—Å–∫–∏–ø–∞–µ–º¬ª —Å –ø—Ä–∏—á–∏–Ω–æ–π.

2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ–∑–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–æ–≤**

   * –û—Ç—Å–µ–∫–∞–µ–º ¬´–º—É—Å–æ—Ä¬ª (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ `id/price/supply`).
   * –°–æ—Ä—Ç–∏—Ä—É–µ–º –ª–∏–º–∏—Ç–∫–∏ –ø–æ –∫–ª—é—á—É: **–º–µ–Ω—å—à–µ supply ‚Üí –¥–æ—Ä–æ–∂–µ ‚Üí —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å**, —á—Ç–æ–±—ã —Å–Ω–∞—á–∞–ª–∞ –ª–æ–≤–∏—Ç—å —Å–∞–º—ã–µ –¥–µ—Ñ–∏—Ü–∏—Ç–Ω—ã–µ –∏ —Ü–µ–Ω–Ω—ã–µ.

3. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (¬´–ø–ª–∞–Ω –ø–æ–∫—É–ø–æ–∫¬ª)**
   –î–ª—è **–∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞** (–≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∫—É–ø–∫–∏:

   * –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞ –∏—â–µ—Ç—Å—è **–ª—É—á—à–∏–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–∞–Ω–∞–ª** (–ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º —Ü–µ–Ω—ã/supply).
   * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–æ–∫ —Å —É—á—ë—Ç–æ–º **–æ—Å—Ç–∞—Ç–∫–∞ –±–∞–ª–∞–Ω—Å–∞** –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ **–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** –ø–æ–¥–∞—Ä–∫–∞.
   * –í –ø–ª–∞–Ω –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: `(account_id, channel_id, gift_id, price, supply)`.
   * –ï—Å–ª–∏ –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á—Ç–æ-—Ç–æ –Ω–µ —Å–æ—à–ª–æ—Å—å (–Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–∞–Ω–∞–ª–æ–≤, –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ –∑–≤—ë–∑–¥ –∏ –ø—Ä.), —ç—Ç–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ `plan_skips`.

4. **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞**

   * –ò–¥—ë–º –ø–æ –ø–ª–∞–Ω—É –∏ –Ω–∞ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ–º:

     ```
     await tg_client.send_gift(chat_id=<ID –∫–∞–Ω–∞–ª–∞>, gift_id=<ID –ø–æ–¥–∞—Ä–∫–∞>)
     ```
   * –£—Å–ø–µ—Ö/–Ω–µ—É—Å–ø–µ—Ö –¥–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ **–ø–æ –∫–∞–Ω–∞–ª–∞–º** –∏ **–ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º**.

5. **–û—Ç—á—ë—Ç—ã**

   * –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ—Ç—á—ë—Ç: –æ–±—â–∞—è —Å–≤–æ–¥–∫–∞, –ø–æ –ø–æ–¥–∞—Ä–∫–∞–º (‚úÖ/‚è≠Ô∏è/‚ùå), –ø–æ –∫–∞–Ω–∞–ª–∞–º –∏ –ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º.
   * –û—Ç—á—ë—Ç —É—Ö–æ–¥–∏—Ç –≤ **–õ–° –≤—Å–µ—Ö –≤–∞—à–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤** (—á–µ—Ä–µ–∑ –≤–∞—à Bot Token –∏–∑ ¬´–ù–∞—Å—Ç—Ä–æ–µ–∫¬ª).

6. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –≤–æ—Ä–∫–µ—Ä —à–ª—ë—Ç **—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –Ω–æ–≤—ã—Ö –ø–æ–¥–∞—Ä–∫–∞—Ö –≤ –∫–∞–Ω–∞–ª—ã/–õ–°.
   –í `gifts_service` –ø–æ–∫—É–ø–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (`asyncio.gather`), –ø–æ–∫—É–ø–∫–∞ **–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
GiftBuyer/
  backend/
    app.py
    auth.py
    db.py
    logger.py
    models.py
    requirements.txt
    migrate_app_db.py
    sessions/                 # .session (gitignored)
    instance/
      gifts_cache/            # .tgs gzip-–∫—ç—à (gitignored)
    routes/
      __init__.py
      auth.py
      account.py
      misc.py
      gifts.py                # API –ø–æ–¥–∞—Ä–∫–æ–≤ + Lottie-–∫—ç—à + SSE
      settings.py             # API –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Bot token)
      channels.py             # API –∫–∞–Ω–∞–ª–æ–≤ (CRUD)
    services/
      __init__.py
      accounts_service.py
      gifts_service.py        # –≤–æ—Ä–∫–µ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤, SSE-—à–∏–Ω–∞, parallel buy+notify
      settings_service.py
      notify_gifts_service.py # –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞/—Ç–µ–∫—Å—Ç–∞ –≤ –∫–∞–Ω–∞–ª—ã/–õ–°
      session_locks_service.py
      tg_clients_service.py   # –µ–¥–∏–Ω—ã–π Pyrogram-–∫–ª–∏–µ–Ω—Ç + tg_call/tg_shutdown
      channels_service.py     # –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è channel_id, probe, –≤–∞–ª–∏–¥–∞—Ü–∏—è
      pyro_login.py           # –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (–≤ —Ç.—á. Premium)
      autobuy_service.py      # –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏ + –æ—Ç—á—ë—Ç—ã –≤ –õ–°
  frontend/
    index.html
    package.json
    package-lock.json
    src/
      api.js                  # fetch-–æ–±—ë—Ä—Ç–∫–∞ + 401
      App.jsx
      auth.js
      main.jsx
      notify.js
      styles.css
      utils/
        openCentered.js
      ui/
        ModalStack.jsx
      pages/
        Dashboard.jsx
        GiftsPage.jsx
        SettingsPage.jsx
        Login.jsx
        Register.jsx
      components/
        AccountList.jsx
        AddApiModal.jsx
        AddAccountModal.jsx
        SelectApiProfileModal.jsx
        ConfirmModal.jsx
        EditChannelModal.jsx
```

> `backend/sessions/`, `backend/instance/` –∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –≤ Git.

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* **Python** 3.11+
* **Node** 18+ / npm 9+
* –†–∞–±–æ—á–∏–π **api\_id/api\_hash** (my.telegram.org ‚Üí API development tools)
* –í–∞—à **Bot Token** (BotFather), —á—Ç–æ–±—ã —Å–ª–∞—Ç—å .tgs-–ø—Ä–µ–≤—å—é –∏ –æ—Ç—á—ë—Ç—ã –≤ –õ–°
* –ß–∞—Ç—ã, –∫—É–¥–∞ –±–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –ø–∏—Å–∞—Ç—å (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª—ã)

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

### Backend

```bash
cd backend
python -m venv .venv
# Windows:
.\.venv\Scripts\activate
# macOS/Linux:
# source .venv/bin/activate

pip install -r requirements.txt

# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–∏–≥—Ä–∞—Ü–∏—è/–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î,
# –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø–µ—Ä–µ–Ω–æ—Å —Å—Ö–µ–º—ã:
python -m backend.migrate_app_db

# –∑–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞ (Flask)
python -m backend.app     # http://localhost:5000
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):**

* `SECRET_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç Flask.
* `GIFTS_DIR` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–¥–∞—Ä–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `gifts_data`).
* `GIFTS_CACHE_DIR` ‚Äî –∫—ç—à .tgs (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `backend/instance/gifts_cache`).
* `GIFTS_ACCS_TTL` ‚Äî –ø–µ—Ä–∏–æ–¥ (—Å–µ–∫) –ø–µ—Ä–µ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤–æ—Ä–∫–µ—Ä–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `60`).

### Frontend

```bash
cd frontend
npm i
npm run dev     # http://localhost:5173
```

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏ `/api` ‚Üí `http://localhost:5000` –≤–æ `vite.config.js`.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –≤ UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:5173`, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å/–≤–æ–π–¥–∏—Ç–µ.
2. –°–æ–∑–¥–∞–π—Ç–µ **API-–ø—Ä–æ—Ñ–∏–ª—å** (api\_id/api\_hash).
3. –î–æ–±–∞–≤—å—Ç–µ **Telegram-–∞–∫–∫–∞—É–Ω—Ç** (—Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí –∫–æ–¥ ‚Üí –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å).
4. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ ¬´**–ü–æ–¥–∞—Ä–∫–∏**¬ª: –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫/–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä .tgs.
5. –í ¬´**–ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö**¬ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ **Bot Token** ‚Äî –±–µ–∑ –Ω–µ–≥–æ –Ω–µ –±—É–¥–µ—Ç —Å—Ç–∏–∫–µ—Ä–æ–≤/–æ—Ç—á—ë—Ç–æ–≤.
6. –í ¬´**–ö–∞–Ω–∞–ª–∞—Ö**¬ª –¥–æ–±–∞–≤–ª—è–π—Ç–µ `channel_id` –≤–∏–¥–∞ `-100‚Ä¶`, –∑–∞–¥–∞–≤–∞–π—Ç–µ **–¥–∏–∞–ø–∞–∑–æ–Ω—ã —Ü–µ–Ω—ã –∏ supply**.
7. –í–∫–ª—é—á–∏—Ç–µ **–∞–≤—Ç–æ–ø–æ–∫—É–ø–∫—É** (–ø–æ–ª–µ `gifts_autorefresh` —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è; –≤ UI –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î).
   –í–æ—Ä–∫–µ—Ä –Ω–∞—á–Ω—ë—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –∏, –µ—Å–ª–∏ –æ–Ω–∏ **–ª–∏–º–∏—Ç–Ω—ã–µ** –∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ñ–∏–ª—å—Ç—Ä—ã ‚Äî –±—É–¥–µ—Ç **–ø–æ–∫—É–ø–∞—Ç—å –Ω–∞ –∫–∞–Ω–∞–ª—ã**.

---

## –ê–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞ ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

* –ü–æ–∫—É–ø–∞–µ–º **—Ç–æ–ª—å–∫–æ –ª–∏–º–∏—Ç–Ω—ã–µ** –ø–æ–¥–∞—Ä–∫–∏ (`is_limited=True`). –ù–µ–ª–∏–º–∏—Ç–Ω—ã–µ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ ¬´–ø—Ä–æ–ø—É—â–µ–Ω—ã¬ª —Å –ø—Ä–∏—á–∏–Ω–æ–π.
* –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞ –ø–æ–¥–±–∏—Ä–∞–µ—Ç—Å—è **–ª—É—á—à–∏–π –∫–∞–Ω–∞–ª** —Å—Ä–µ–¥–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º `price` –∏ `supply`:

  * –ï—Å–ª–∏ `supply_min/max` —É –∫–∞–Ω–∞–ª–∞ `null` ‚Äî —Å—á–∏—Ç–∞–µ–º ¬´–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è¬ª.
  * –ß–µ–º **—É–∂–µ** ¬´–æ–∫–Ω–æ¬ª –ø–æ supply –∏ —á–µ–º **–≤—ã—à–µ** `price_max`, —Ç–µ–º **–≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** –∫–∞–Ω–∞–ª–∞.
* –ü–ª–∞–Ω —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **–ø–æ –≤—Å–µ–º –∞–∫–∫–∞—É–Ω—Ç–∞–º** (—Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —É–±—ã–≤–∞–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞):

  * –ù–∞ –∫–∞–∂–¥—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å—Ç–∞–≤–∏—Ç—Å—è —Å—Ç–æ–ª—å–∫–æ –ø–æ–∫—É–ø–æ–∫, —Å–∫–æ–ª—å–∫–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç **–±–∞–ª–∞–Ω—Å** –∏ **–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** –ø–æ–¥–∞—Ä–∫–∞.
* –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–º–µ–Ω–Ω–æ **–≤ –∫–∞–Ω–∞–ª**: `send_gift(chat_id=<ID –∫–∞–Ω–∞–ª–∞>, gift_id=...)`.
* –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã, –ø–æ—á–µ–º—É –Ω–µ –∫—É–ø–∏–ª–∏:

  * `no_channel_match` ‚Äî –Ω–µ –Ω–∞—à–ª–æ—Å—å –∫–∞–Ω–∞–ª–æ–≤, –≥–¥–µ –∏ `price`, –∏ `supply` —É–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∏–ª—å—Ç—Ä—ã.
  * `not_enough_stars` / `insufficient_account_balance` ‚Äî –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ –∑–≤—ë–∑–¥.
  * `send_gift_failed` ‚Äî —Å–∞–º –≤—ã–∑–æ–≤ `send_gift` –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è (–Ω–µ—Ç –ø—Ä–∞–≤ –ø–∏—Å–∞—Ç—å –≤ –∫–∞–Ω–∞–ª, –Ω–µ —á–ª–µ–Ω –∫–∞–Ω–∞–ª–∞, gift –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ç—Ä–µ–±—É—é—Ç—Å—è Premium, –∏ —Ç.–ø.).
  * `invalid/price/supply` ‚Äî –ø–æ–¥–∞—Ä–æ–∫ –Ω–µ –ø—Ä–æ—à—ë–ª –±–∞–∑–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é.
* –í –õ–° —É—Ö–æ–¥–∏—Ç **—á–µ–ª–æ–≤–µ—á–Ω—ã–π –æ—Ç—á—ë—Ç** —Å —ç–º–æ–¥–∑–∏: —Å–≤–æ–¥–∫–∞, –ø–æ –ø–æ–¥–∞—Ä–∫–∞–º (—á—Ç–æ –∏ –∫—É–¥–∞ –∫—É–ø–∏–ª–∏, –ª–∏–±–æ –ø–æ—á–µ–º—É –ø—Ä–æ–ø—É—â–µ–Ω–æ), –ø–æ –∫–∞–Ω–∞–ª–∞–º –∏ –ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º.

---

## –î–µ–ø–ª–æ–π (production)

> –í dev-—Ä–µ–∂–∏–º–µ Flask –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, **–Ω–µ** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞. –ù–∏–∂–µ –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: **systemd + Gunicorn** –∏ **Docker Compose**.

### –í–∞—Ä–∏–∞–Ω—Ç A ‚Äî systemd + Gunicorn (Linux)

**1) –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

```bash
# –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ
python -m venv .venv
source .venv/bin/activate
pip install -r backend/requirements.txt
cd frontend && npm ci && npm run build && cd ..
```

–†–∞–∑–¥–∞–≤–∞—Ç—å `frontend/dist/` –º–æ–∂–Ω–æ –ª—é–±—ã–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º (nginx/caddy), –∞ `/api` –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ backend.

**2) WSGI-—Å–µ—Ä–≤–µ—Ä**

–§–∞–π–ª `wsgi.py` (–≤ `backend/`), –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç:

```python
from backend.app import create_app
app = create_app()
```

**3) Gunicorn –∑–∞–ø—É—Å–∫**
–¢–∞–∫ –∫–∞–∫ –≤–Ω—É—Ç—Ä–∏ backend –µ—Å—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω—â–∏–Ω–∞ + —Ñ–æ–Ω–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏, —É–¥–µ—Ä–∂–∏–≤–∞–µ–º **1 –≤–æ—Ä–∫–µ—Ä**, –Ω–æ –¥–∞—ë–º **–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å**:

```bash
cd backend
../.venv/bin/gunicorn wsgi:app \
  --bind 0.0.0.0:5000 \
  --workers 1 \
  --threads 8 \
  --timeout 120
```

> –ù–∞ Windows –≤–º–µ—Å—Ç–æ Gunicorn –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Waitress**:
>
> ```bash
> pip install waitress
> waitress-serve --listen=0.0.0.0:5000 backend.wsgi:app
> ```

**4) systemd-—é–Ω–∏—Ç**

`/etc/systemd/system/giftbuyer.service`:

```ini
[Unit]
Description=GiftBuyer backend
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/opt/GiftBuyer/backend
Environment="SECRET_KEY=change-me"
Environment="GIFTS_DIR=/opt/GiftBuyer/gifts_data"
Environment="GIFTS_CACHE_DIR=/opt/GiftBuyer/backend/instance/gifts_cache"
Environment="GIFTS_ACCS_TTL=60"
ExecStart=/opt/GiftBuyer/.venv/bin/gunicorn wsgi:app --bind 0.0.0.0:5000 --workers 1 --threads 8 --timeout 120
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable --now giftbuyer
```

**5) Nginx (–ø—Ä–∏–º–µ—Ä)**

```nginx
server {
  listen 80;
  server_name your.domain;

  # —Å—Ç–∞—Ç–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–∞
  root /opt/GiftBuyer/frontend/dist;

  location / {
    try_files $uri /index.html;
  }

  # API
  location /api/ {
    proxy_pass http://127.0.0.1:5000/api/;
    proxy_set_header Host $host;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
  }

  # SSE (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)
  location /api/gifts/stream {
    proxy_pass http://127.0.0.1:5000/api/gifts/stream;
    proxy_set_header Host $host;
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Cache-Control "no-cache";
  }
}
```

### –í–∞—Ä–∏–∞–Ω—Ç B ‚Äî Docker Compose

`docker-compose.yml` (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä):

```yaml
version: "3.8"
services:
  backend:
    build: ./backend
    environment:
      SECRET_KEY: "change-me"
      GIFTS_DIR: /data/gifts_data
      GIFTS_CACHE_DIR: /app/instance/gifts_cache
      GIFTS_ACCS_TTL: "60"
    volumes:
      - ./backend/sessions:/app/sessions
      - ./data:/data
    ports:
      - "5000:5000"
    restart: unless-stopped

  frontend:
    build: ./frontend
    ports:
      - "5173:80"
    restart: unless-stopped
```

> –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ backend –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å gunicorn –∫–∞–∫ –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ A (Dockerfile –ø–æ–¥–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º).
> –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `sessions/` –∏ `gifts_cache/`/`gifts_data` –Ω–∞ —Ö–æ—Å—Ç –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è

* **User.gifts\_autorefresh** ‚Äî –≤–∫–ª/–≤—ã–∫–ª –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫—É.
* **UserSettings.bot\_token** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ .tgs-—Å—Ç–∏–∫–µ—Ä–æ–≤ –∏ —Ç–µ–∫—Å—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª—ã/–õ–° (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –æ—Ç—á—ë—Ç—ã).
* **Channel**:

  * `channel_id` –≤–∏–¥–∞ `-100‚Ä¶` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
  * `price_min` / `price_max` ‚Äî –≤ –∑–≤—ë–∑–¥–∞—Ö.
  * `supply_min` / `supply_max` ‚Äî –æ–±—â–µ–µ –∏–∑–¥–∞–Ω–∏–µ (–µ—Å–ª–∏ `null`, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–µ—Ç).
* **Account**:

  * –ø—Ä–∏–≤—è–∑–∞–Ω –∫ API-–ø—Ä–æ—Ñ–∏–ª—é;
  * –≤ UI –≤–∏–¥–µ–Ω –±–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥; –±–∞–ª–∞–Ω—Å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.

---

## –û—Ç—á—ë—Ç—ã –∏ –ª–æ–≥–∏

* –í **–∫–æ–Ω—Å–æ–ª–∏**: –ø–æ–¥—Ä–æ–±–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø–ª–∞–Ω/–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫ –ø–æ –∫–∞–Ω–∞–ª–∞–º/–∞–∫–∫–∞—É–Ω—Ç–∞–º, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏.
* –í **–õ–° (–≤—Å–µ–º –≤–∞—à–∏–º –∞–∫–∫–∞—É–Ω—Ç–∞–º)**:

```
üßæ –û—Ç—á—ë—Ç –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏
üìä –ù–æ–≤—ã—Ö: 3 | –ö—É–ø–ª–µ–Ω–æ: 2 | –ü—Ä–æ–ø—É—â–µ–Ω–æ: 1

üì¶ –ü–æ –ø–æ–¥–∞—Ä–∫–∞–º:
‚Ä¢ ‚úÖ 123456 | 25‚≠ê | supply=1000 ‚Üí ch=-100111 acc=1337
‚Ä¢ ‚è≠Ô∏è 654321 | 50‚≠ê | supply=‚àû ‚Üí non-limited (skipped)
‚Ä¢ ‚ùå 222333 | 10‚≠ê | supply=500 ‚Üí –ø—Ä–∏—á–∏–Ω–∞ ch=-100222: insufficient_account_balance acc=1338 bal=5 need=10

üõ∞Ô∏è –ü–æ –∫–∞–Ω–∞–ª–∞–º:
‚Ä¢ -100111: plan=1 ok=1 fail=0 reasons=0
‚Ä¢ -100222: plan=1 ok=0 fail=0 reasons=1

üë§ –ü–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º:
‚Ä¢ acc=1337: plan=1 üí∞spent=25 start=100 end=75 buys=1
‚Ä¢ acc=1338: plan=1 üí∞spent=0 start=5 end=5 buys=0
```

---

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

* **`send_gift_failed`**
  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

  * –∞–∫–∫–∞—É–Ω—Ç **—Å–æ—Å—Ç–æ–∏—Ç** –≤ –∫–∞–Ω–∞–ª–µ;
  * —É –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–æ –ø–∏—Å–∞—Ç—å (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π), –∏ **–∞–∫–∫–∞—É–Ω—Ç** –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å gift;
  * gift —É–∂–µ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è/–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è;
  * gift **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç Premium**, –µ—Å–ª–∏ —É –∞–∫–∫–∞—É–Ω—Ç–∞ –µ–≥–æ –Ω–µ—Ç;
  * –±–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω.

* **–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫, ¬´no\_channel\_match¬ª**
  –ü–æ–¥–∞—Ä–æ–∫ –Ω–µ –ø–æ–ø–∞–ª –≤ —Ä–∞–º–∫–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `price_min/max` –∏ `supply_min/max`.

* **–ù–∏—á–µ–≥–æ –Ω–µ –≤–∏–¥–Ω–æ –≤ ¬´–ü–æ–¥–∞—Ä–∫–∞—Ö¬ª**
  –ù–∞–∂–º–∏—Ç–µ —Ä—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –≤–æ—Ä–∫–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ .tgs).

* **Windows –ø—Ä–æ–¥–∞–∫—à–µ–Ω**
  Gunicorn –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `waitress-serve` –∏–ª–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ –Ω–∞ Linux-—Å–µ—Ä–≤–µ—Ä–µ.

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –•—Ä–∞–Ω–∏–º —Ç–æ–∫–µ–Ω –≤ httpOnly-cookie.
* –°–µ—Å—Å–∏–∏ Pyrogram –ª–µ–∂–∞—Ç –≤ `backend/sessions/` (–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ).
* –ë–æ—Ç-—Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –≤ —Ç–∞–±–ª–∏—Ü–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫; –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ë–î –∏ —Å–µ—Ä–≤–µ—Ä—É.

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

Apache-2.0 ¬© 2025 Vova Orig. –°–º. LICENSE –∏ NOTICE.

---
